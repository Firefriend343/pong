<html>
  <head>
    <title>Pong Game</title>
  
    <style>
      body { background:darkgray; }
      img { position:absolute; image-rendering:pixelated; transform-origin: 50% 50%; }
      div { position:absolute; }
      #game-container { top:0px; left:0px; width:1250px; height:800px; display:block; border:5px solid black;}
      #paddle { top:100px; left:100px; width:150px; height:40px; border-radius:5px; transition:0.12s; }
      #paddle-container { }
      #ball-container { display:none; }
      #ball { top:100px; left:300px; height:49px; width:49px; border-radius:50%; }
      .ball {  }
    </style>
  </head>
  <body>
  
    <div id="game-container">
      <div id="paddle-container"><img id="paddle" src="pong-paddle.png"></img></div>
      <div id="ball-container"><img class="ball" id="ball" src="pong-ball.png"></img></div>
    </div>
  
    <script>
      var paddle = $("paddle");
      var paddleDeg = 0;
      var localDegree = paddleDeg + "deg";
      var startDifficulty = null;
      var gameLoop = 0;
      var allBalls = $$('.ball');
      var timeStepSec = 1;
      var allImgs = document.body.querySelectorAll('img');
      
      function $ (id) {
        return document.getElementById(id);
      }
      function $$ (sel) {
        return document.querySelectorAll(sel);
      }
      
      function startingDifficulty() {
        startDifficulty = Number(prompt("Select your number of difficulty(1-5)."));
        paddle.style.top = "100px";
        paddle.style.left = "100px";
        paddle.style.transform = "rotate(90deg)";
        paddleDeg = 90;
        localDegree = paddleDeg + "deg";
      }
      
      document.addEventListener('keydown', idKey);   
      function idKey(e) {
        if (e.code == "KeyA") {
          paddleDeg = Math.min(135, Number(paddleDeg + 5));
          localDegree = paddleDeg + "deg";
          paddle.style.transform = "rotate(" + localDegree + ")";         
          console.log("turn-right");
        }
        else if (e.code == "KeyD") {
          paddleDeg = Math.max(45, Number(paddleDeg - 5));
          localDegree = paddleDeg + "deg";
          paddle.style.transform = "rotate(" + localDegree + ")";         
          console.log("turn-left");
        }
        else if (e.code == "KeyW") {
          paddle.style.top = Number(Number(paddle.style.top.split("p")[0]) - 15 - startDifficulty / 1.5) + "px";
        }
        else if (e.code == "KeyS") {
          paddle.style.top = Number(Number(paddle.style.top.split("p")[0]) + 15 + startDifficulty / 1.5) + "px";
        }
        else {
          console.log("wrong key");
        }
      }
      
      function startGame() {
        console.log("game begins");
        ///setInterval(deleteLoop, 10);
        ///3,2,1 thing
        setTimeout(function(){
          setInterval(gamePlayLoop, Number(900 + 3500 / startDifficulty));
          setInterval(moveBallLoop, Number(100 - startDifficulty * 10));
        }, 5000);
      }
      
      function gamePlayLoop() {
        var ball = $("ball");
        var container = $("game-container");
        var newBall = ball.cloneNode(false);
        newBall.id = ball.id + "-" + Number(gameLoop + 1);
        newBall.style.display = "block";
        var randomTop = Number(Math.floor(Math.random() * 600 + 100));
        newBall.style.top = randomTop + "px";
        newBall.style.left = "1200px";
        newBall.src = ball.src;
        newBall.style.transition = Number(0.1 - startDifficulty / 100) + "s linear";
        container.appendChild(newBall);
        allBalls = $$('.ball');
        allDivs = document.body.querySelectorAll('div');
        console.log("loop");
        gameLoop++;
        if (Number(paddle.style.top.split("p")[0]) >= 650) {
          paddle.style.top = "650px";
        }
      }
      
      function moveBallLoop() {
        allBalls = $$('.ball');
        for (const bEl of allBalls) {
          bEl.style.left = Number(bEl.style.left.split("p")[0] - 10) + "px";
          if (Number(bEl.style.top.split("p")[0]) >= Number(paddle.style.top.split("p")[0]) 
              && Number(bEl.style.top.split("p")[0]) <= Number(paddle.style.top.split("p")[0]) + 150
              && Number(bEl.style.left.split("p")[0]) >= 100 && Number(bEl.style.left.split("p")[0]) <= 140) {
            ///bounce off-screen algorithm
            if (Number(paddle.style.transform.split("(")[1].split("d")[0]) >= 91) {
              bEl.style.top = 860 + Number(paddle.style.transform.split("(")[1].split("d")[0]);
              var deleteTimestamp = Number(bEl.style.top = 860 + Number(paddle.style.transform.split("(")[1].split("d")[0]));
            }
            else {
              bEl.style.top = -10 - Number(paddle.style.transform.split("(")[1].split("d")[0]);
            }
            if (Number(paddle.style.transform.split("(")[1].split("d")[0]) >= 91) {
              bEl.style.left = 1200 - Number(paddle.style.transform.split("(")[1].split("d")[0]) * 5;
            }
            else {
              bEl.style.left = 1200 - Number(paddle.style.transform.split("(")[1].split("d")[0]) * 10;
            }
            bEl.style.transition = "12s linear";
            bEl.classList.add("collided");
            bEl.classList.remove("ball");
            setTimeout(function(){
              deleteBall(bEl);
            }, 10000 - deleteTimestamp * 2);
            ///end
            console.log("collision");
          }
        }
      }
      
      function deleteBall(bEl) {
        bEl.parentNode.removeChild(bEl);
        console.log("ball removed");
      }
      
      function deleteLoop() {
        allImgs = document.body.querySelectorAll('img');
        console.log("loop executes");
        var container = $("game-container");
        for (const dEl of allImgs) {
          if (dEl.id != "ball") {
            if (Number(dEl.style.top.split("p")[0]) < Number(container.style.top.split("p")[0]) - 50) {
              dEl.parentNode.removeChild(dEl);
            }
            if (Number(dEl.style.left.split("p")[0]) < Number(container.style.left.split("p")[0]) - 50) {
              dEl.parentNode.removeChild(dEl);
            }
            if (Number(dEl.style.top.split("p")[0]) > Number(container.style.top.split("p")[0]) + 800) {
              dEl.parentNode.removeChild(dEl);
            }
            if (Number(dEl.style.left.split("p")[0]) > Number(container.style.left.split("p")[0]) + 1250) {
              dEl.parentNode.removeChild(dEl);
            }
          }
        }
      }
      
      ///All opening functions
      startingDifficulty();
      startGame();
      
    </script>
  </body>
</html>
<!--Version 0.126-->
